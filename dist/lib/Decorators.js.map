{"version":3,"sources":["lib/Decorators.ts"],"names":["Collection","Index","Validate","Property","ObjectID"],"mappings":"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","file":"lib/Decorators.js","sourcesContent":["/// <reference path=\"../_references.d.ts\" />\r\nimport MongoDB = require('mongodb');\r\nimport _ = require('lodash');\r\nimport skmatc = require('skmatc');\r\nimport Instance from './Instance';\r\nimport {Index, IndexSpecification} from './Index';\r\nimport {Schema} from './Schema';\r\nimport {InstanceImplementation} from './ModelInterfaces';\r\n\r\nexport function Collection(name: string) {\r\n\treturn function(target: InstanceImplementation<any, any>) {\r\n\t\ttarget.collection = name;\r\n\t};\r\n}\r\n\r\nexport function Index(spec: IndexSpecification, options?: MongoDB.IndexOptions) {\r\n\treturn function(target: InstanceImplementation<any,any>) {\r\n\t\ttarget.indexes = target.indexes || [];\r\n\t\t\r\n\t\tif (options) target.indexes.push(<Index>{ spec: spec, options: options });\r\n\t\telse target.indexes.push(<Index>{ spec: spec });\r\n\t}\r\n}\r\n\r\nexport function Validate(forType: any, validate: (schema: any, data: any, path: string) => Skmatc.Result) {\r\n\treturn function(target: InstanceImplementation<any,any>) {\r\n\t\ttarget.validators = target.validators || [];\r\n\t\ttarget.validators.push(skmatc.create(schema => schema === forType, validate));\r\n\t}\r\n}\r\n\r\nexport function Property(asType: any, required?: boolean): (target: { constructor: Function }, name: string) => void;\r\nexport function Property(name: string, asType: any, required?: boolean): (target: Function) => void;\r\nexport function Property(...args: any[]): (target: any, name?: string) => void {\r\n\tlet name = null,\r\n\t\tasType = false,\r\n\t\trequired = true;\r\n\t\r\n\tif (args.length > 1 && typeof args[args.length - 1] === 'boolean')\r\n\t\trequired = args.pop();\r\n\t\r\n\treturn function(target: any, property?: string) {\r\n\t\tif (!property) name = args.shift();\r\n\t\telse {\r\n\t\t\tname = property;\r\n\t\t\ttarget = target.constructor;\r\n\t\t}\r\n\t\tasType = args.pop();\r\n\t\t\r\n\t\ttarget.schema = target.schema || <Schema>{};\r\n\t\tif(!required) target.schema[name] = { $required: required, $type: asType };\r\n\t\telse target.schema[name] = asType;\r\n\t}\r\n}\r\n\r\nexport function ObjectID(target: { constructor: typeof Instance }, name: string) {\r\n\ttarget.constructor.schema = target.constructor.schema || <Schema>{};\r\n\ttarget.constructor.schema[name] = { $required: false, $type: /^[0-9a-f]{24}$/ };\r\n\ttarget.constructor.identifier = {\r\n\t\tapply: function(value) { \r\n\t\t\treturn (value && value._bsontype == 'ObjectID') ? new MongoDB.ObjectID(value.id).toHexString() : value;\r\n\t\t},\r\n\t\treverse: function (value) {\r\n\t\t\tif (value === null || value === undefined) return undefined;\r\n\t\t\tif (value && /^[a-f0-9]{24}$/.test(value)) return MongoDB.ObjectID.createFromHexString(value);\r\n\t\t\treturn value;\r\n\t\t}\r\n\t};\r\n}"],"sourceRoot":"/source/"}