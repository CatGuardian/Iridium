{"version":3,"sources":["lib/Decorators.ts"],"names":["Index","Identifier","GetDescriptor","Property","ObjectID","Transform"],"mappings":"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","file":"lib/Decorators.js","sourcesContent":["/// <reference path=\"../_references.d.ts\" />\r\nimport MongoDB = require('mongodb');\r\n\r\nimport Instance from './Instance';\r\nimport {Index, IndexSpecification} from './Index';\r\n\r\nexport function Index(spec: IndexSpecification, options?: MongoDB.IndexOptions) {\r\n\treturn function(target: typeof Instance) {\r\n\t\ttarget.indexes = target.indexes || [];\r\n\t\t\r\n\t\tif (options) target.indexes.push(<Index>{ spec: spec, options: options });\r\n\t\telse target.indexes.push(<Index>{ spec: spec });\r\n\t}\r\n}\r\n\r\nexport function Identifier(fromDB: (value: any) => any, toDB: (value: any) => any) {\r\n\treturn function(target: typeof Instance) {\r\n\t\ttarget.identifier = {\r\n\t\t\tapply: fromDB,\r\n\t\t\treverse: toDB\r\n\t\t};\r\n\t}\r\n}\r\n\r\nfunction GetDescriptor(target: Object, name: string): PropertyDescriptor {\r\n\treturn Object.getOwnPropertyDescriptor(target, name) || {\r\n\t\tconfigurable: true,\r\n\t\tenumerable: true,\r\n\t\twritable: true\r\n\t};\r\n}\r\n\r\nexport function Property(target: Object, name: string, descriptor?: PropertyDescriptor) {\r\n\tlet desc = descriptor || GetDescriptor(target, name);\r\n\tdesc.get = function() { return this.document[name]; };\r\n\tdesc.set = function(value) { this.document[name] = value; }; \r\n\t\r\n\tif(descriptor) return desc;\r\n\tObject.defineProperty(target, name, desc);\r\n}\r\n\r\nexport function ObjectID(target: Object, name: string, descriptor?: PropertyDescriptor) {\r\n\tlet desc = descriptor || GetDescriptor(target, name);\r\n\t\r\n\tdesc = Transform(function(value) { \r\n\t\treturn (value && value._bsontype == 'ObjectID') ? new MongoDB.ObjectID(value.id).toHexString() : value;\r\n\t}, function (value) {\r\n        if (value === null || value === undefined) return undefined;\r\n        if (value && /^[a-f0-9]{24}$/.test(value)) return MongoDB.ObjectID.createFromHexString(value);\r\n        return value;\r\n    });\r\n\t\r\n\tif(descriptor) return desc;\r\n\tObject.defineProperty(target, name, desc);\r\n}\r\n\r\nexport function Transform(fromDB: (value: any) => any, toDB: (value: any) => any) {\r\n\treturn function(target: Object, name: string, descriptor?: any) {\r\n\t\tlet desc = descriptor || GetDescriptor(target, name);\r\n\t\tlet get = desc.get || function() { return this.document[name]; },\r\n\t\t\tset = desc.set || function(value) { this.document[name] = value; };\r\n\t\t\t\r\n\t\tdesc.get = function() {\r\n\t\t\treturn fromDB(get.call(this));\r\n\t\t};\r\n\t\t\r\n\t\tdesc.set = function(value) {\r\n\t\t\treturn set.call(this, toDB(value));\t\r\n\t\t};\r\n\t\t\t\r\n\t\tif(descriptor) return desc;\r\n\t\tObject.defineProperty(target, name, desc);\r\n\t}\r\n}"],"sourceRoot":"/source/"}